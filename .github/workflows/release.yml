name: Release

# Trigger only on direct pushes to main (change branch if needed)
on:
  push:
    branches:
      - main

permissions:
  # Allow writing releases + pushes if semantic-release needs to update files/tags
  contents: write
  # Allows publishing GitHub Releases
  id-token: write

jobs:
  release:
    name: "ðŸ“¦ Semantic Release"
    runs-on: ubuntu-latest
    concurrency:
      group: release
      cancel-in-progress: true

    steps:
      # Always fetch full history so semantic-release sees all commits/tags
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Set up a Python environment
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      # Install dependencies (including pythonâ€‘semanticâ€‘release)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install python-semantic-release

      # Run semantic-release to version & publish the release
      - name: Run Python Semantic Release
        env:
          # Token used to create GitHub tag & publish Release
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Optional: identify the CI commits with a user for git pushes
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          # The publish command will:
          #   â€¢ determine the new version from commits
          #   â€¢ update version metadata
          #   â€¢ tag and push tag
          #   â€¢ create a GitHub Release with change notes
          semantic-release publish
